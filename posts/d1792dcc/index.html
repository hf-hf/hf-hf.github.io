<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>RESTful API收集整理 | 混饭's Notes</title><meta name="description" content="RESTful API路径定义版本号在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IO"><meta name="keywords" content="RESTful"><meta name="author" content="混饭"><meta name="copyright" content="混饭"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/images/avatar.png"><link rel="canonical" href="http://hunfan.top/posts/d1792dcc/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta property="og:type" content="article"><meta property="og:title" content="RESTful API收集整理"><meta property="og:url" content="http://hunfan.top/posts/d1792dcc/"><meta property="og:site_name" content="混饭's Notes"><meta property="og:description" content="RESTful API路径定义版本号在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IO"><meta property="og:image" content="http://hunfan.top/upload/homePage/20180906170330.jpg"><meta property="article:published_time" content="2018-09-06T07:48:34.000Z"><meta property="article:modified_time" content="2020-07-08T02:13:03.264Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="Linux查询占用文件的进程" href="http://hunfan.top/posts/c4cf9967/"><link rel="next" title="Mysql FEDREATED存储引擎" href="http://hunfan.top/posts/9c6dc1e8/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6cd8ae14adb2fe3dc7047ddfa0d40d73";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"77ZW8HG1F0","apiKey":"924aaf9b16831d3af864330abb1b94cf","indexName":"github","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"top-center"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="混饭's Notes" type="application/atom+xml">
</head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">58</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">53</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">1</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#RESTful-API"><span class="toc-number">1.</span> <span class="toc-text">RESTful API</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#路径定义"><span class="toc-number">2.</span> <span class="toc-text">路径定义</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#版本号"><span class="toc-number">2.1.</span> <span class="toc-text">版本号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#资源路径"><span class="toc-number">2.2.</span> <span class="toc-text">资源路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求方式"><span class="toc-number">2.3.</span> <span class="toc-text">请求方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询参数"><span class="toc-number">2.4.</span> <span class="toc-text">查询参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#状态码"><span class="toc-number">2.5.</span> <span class="toc-text">状态码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异常响应"><span class="toc-number">2.6.</span> <span class="toc-text">异常响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求参数"><span class="toc-number">2.7.</span> <span class="toc-text">请求参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应参数"><span class="toc-number">2.8.</span> <span class="toc-text">响应参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一个完整的案例"><span class="toc-number">2.9.</span> <span class="toc-text">一个完整的案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参数接收"><span class="toc-number">3.</span> <span class="toc-text">参数接收</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MediaType的选择"><span class="toc-number">3.1.</span> <span class="toc-text">MediaType的选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路径参数"><span class="toc-number">3.2.</span> <span class="toc-text">路径参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求头参数"><span class="toc-number">3.3.</span> <span class="toc-text">请求头参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求体参数"><span class="toc-number">3.4.</span> <span class="toc-text">请求体参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开发实例"><span class="toc-number">3.5.</span> <span class="toc-text">开发实例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#返回值"><span class="toc-number">4.</span> <span class="toc-text">返回值</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#格式选择"><span class="toc-number">4.1.</span> <span class="toc-text">格式选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据返回格式"><span class="toc-number">4.2.</span> <span class="toc-text">数据返回格式</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/upload/homePage/20180906170330.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">混饭's Notes</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">RESTful API收集整理</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2018-09-06 15:48:34"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2018-09-06</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-08 10:13:03"><i class="fas fa-history fa-fw"></i> 更新于 2020-07-08</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/uncategorized/">uncategorized</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h1><h1 id="路径定义"><a href="#路径定义" class="headerlink" title="路径定义"></a>路径定义</h1><h2 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h2><p>在 RESTful API 中，API 接口应该尽量兼容之前的版本。但是，在实际业务开发场景中，可能随着业务需求的不断迭代，现有的 API 接口无法支持旧版本的适配，此时如果强制升级服务端的 API 接口将导致客户端旧有功能出现故障。实际上，Web 端是部署在服务器，因此它可以很容易为了适配服务端的新的 API 接口进行版本升级，然而像 Android 端、IOS 端、PC 端等其他客户端是运行在用户的机器上，因此当前产品很难做到适配新的服务端的 API 接口，从而出现功能故障，这种情况下，用户必须升级产品到最新的版本才能正常使用。</p>
<p>为了解决这个版本不兼容问题，在设计 RESTful API 的一种实用的做法是使用版本号。一般情况下，我们会在 url 中保留版本号，并同时兼容多个版本。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;v1&#x2F;users&#x2F;&#123;user_id&#125;  &#x2F;&#x2F; 版本 v1 的查询用户列表的 API 接口</span><br><span class="line">【GET】  &#x2F;v2&#x2F;users&#x2F;&#123;user_id&#125;  &#x2F;&#x2F; 版本 v2 的查询用户列表的 API 接口</span><br></pre></td></tr></table></figure>

<p>现在，我们可以不改变版本 v1 的查询用户列表的 API 接口的情况下，新增版本 v2 的查询用户列表的 API 接口以满足新的业务需求，此时，客户端的产品的新功能将请求新的服务端的 API 接口地址。虽然服务端会同时兼容多个版本，但是同时维护太多版本对于服务端而言是个不小的负担，因为服务端要维护多套代码。这种情况下，常见的做法不是维护所有的兼容版本，而是只维护最新的几个兼容版本，例如维护最新的三个兼容版本。在一段时间后，当绝大多数用户升级到较新的版本后，废弃一些使用量较少的服务端的老版本API 接口版本，并要求使用产品的非常旧的版本的用户强制升级。</p>
<p>注意的是，“不改变版本 v1 的查询用户列表的 API 接口”主要指的是对于客户端的调用者而言它看起来是没有改变。而实际上，如果业务变化太大，服务端的开发人员需要对旧版本的 API 接口使用适配器模式将请求适配到新的API 接口上。</p>
<h2 id="资源路径"><a href="#资源路径" class="headerlink" title="资源路径"></a>资源路径</h2><p>RESTful API 的设计以资源为核心，每一个 URI 代表一种资源。因此，URI 不能包含动词，只能是名词。注意的是，形容词也是可以使用的，但是尽量少用。一般来说，不论资源是单个还是多个，API 的名词要以复数进行命名。此外，命名名词的时候，要使用小写、数字及下划线来区分多个单词。这样的设计是为了与 json 对象及属性的命名方案保持一致。例如，一个查询系统标签的接口可以进行如下设计。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;v1&#x2F;tags&#x2F;&#123;tag_id&#125;</span><br></pre></td></tr></table></figure>

<p>同时，资源的路径应该从根到子依次如下。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;&#x2F;&#123;sub_resources&#125;&#x2F;&#123;sub_resource_id&#125;&#x2F;&#123;sub_resource_property&#125;</span><br></pre></td></tr></table></figure>

<p>我们来看一个“添加用户的角色”的设计，其中“用户”是主资源，“角色”是子资源。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【POST】  &#x2F;v1&#x2F;users&#x2F;&#123;user_id&#125;&#x2F;roles&#x2F;&#123;role_id&#125; &#x2F;&#x2F; 添加用户的角色</span><br></pre></td></tr></table></figure>

<p>有的时候，当一个资源变化难以使用标准的 RESTful API 来命名，可以考虑使用一些特殊的 actions 命名。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;&#x2F;actions&#x2F;&#123;action&#125;</span><br></pre></td></tr></table></figure>

<p>举个例子，“密码修改”这个接口的命名很难完全使用名词来构建路径，此时可以引入 action 命名。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【PUT】  &#x2F;v1&#x2F;users&#x2F;&#123;user_id&#125;&#x2F;password&#x2F;actions&#x2F;modify &#x2F;&#x2F; 密码修改</span><br></pre></td></tr></table></figure>

<p>当路径中出现多个单词时，请使用中划线 <code>-</code> 来连接。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;v1&#x2F;order&#x2F;my-orders &#x2F;&#x2F; 获取我的订单信息</span><br></pre></td></tr></table></figure>

<h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><p>可以通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。其中，GET 用于查询资源，POST 用于创建资源，PUT 用于更新服务端的资源的全部信息，PATCH 用于更新服务端的资源的部分信息，DELETE 用于删除服务端的资源。</p>
<p>这里，笔者使用“用户”的案例进行回顾通过 GET、 POST、 PUT、 PATCH、 DELETE 等方式对服务端的资源进行操作。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】          &#x2F;users                # 查询用户信息列表</span><br><span class="line">【GET】          &#x2F;users&#x2F;1001           # 查看某个用户信息</span><br><span class="line">【POST】         &#x2F;users                # 新建用户信息</span><br><span class="line">【PUT】          &#x2F;users&#x2F;1001           # 更新用户信息(全部字段)</span><br><span class="line">【PATCH】        &#x2F;users&#x2F;1001           # 更新用户信息(部分字段)</span><br><span class="line">【DELETE】       &#x2F;users&#x2F;1001           # 删除用户信息</span><br></pre></td></tr></table></figure>

<h2 id="查询参数"><a href="#查询参数" class="headerlink" title="查询参数"></a>查询参数</h2><p>RESTful API 接口应该提供参数，过滤返回结果。其中，offset 指定返回记录的开始位置。一般情况下，它会结合 limit 来做分页的查询，这里 limit 指定返回记录的数量。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;?offset&#x3D;0&amp;limit&#x3D;20</span><br></pre></td></tr></table></figure>

<p>同时，orderby 可以用来排序，但仅支持单个字符的排序，如果存在多个字段排序，需要业务中扩展其他参数进行支持。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;?orderby&#x3D;&#123;field&#125; [asc|desc]</span><br></pre></td></tr></table></figure>

<p>为了更好地选择是否支持查询总数，我们可以使用 count 字段，count 表示返回数据是否包含总条数，它的默认值为 false。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;?count&#x3D;[true|false]</span><br></pre></td></tr></table></figure>

<p>上面介绍的 offset、 limit、 orderby 是一些公共参数。此外，业务场景中还存在许多个性化的参数。我们来看一个例子。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】  &#x2F;v1&#x2F;categorys&#x2F;&#123;category_id&#125;&#x2F;apps&#x2F;&#123;app_id&#125;?enable&#x3D;[1|0]&amp;os_type&#x3D;&#123;field&#125;&amp;device_ids&#x3D;&#123;field,field,…&#125;</span><br></pre></td></tr></table></figure>

<p>注意的是，不要过度设计，只返回用户需要的查询参数。此外，需要考虑是否对查询参数创建数据库索引以提高查询性能。</p>
<h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><p>使用适合的状态码很重要，而不应该全部都返回状态码 200，或者随便乱使用。这里，列举笔者在实际开发过程中常用的一些状态码，以供参考。</p>
<table>
<thead>
<tr>
<th>状态码</th>
<th align="right">描述</th>
</tr>
</thead>
<tbody><tr>
<td>200</td>
<td align="right">请求成功</td>
</tr>
<tr>
<td>201</td>
<td align="right">创建成功</td>
</tr>
<tr>
<td>400</td>
<td align="right">错误的请求</td>
</tr>
<tr>
<td>401</td>
<td align="right">未验证</td>
</tr>
<tr>
<td>403</td>
<td align="right">被拒绝</td>
</tr>
<tr>
<td>404</td>
<td align="right">无法找到</td>
</tr>
<tr>
<td>409</td>
<td align="right">资源冲突</td>
</tr>
<tr>
<td>500</td>
<td align="right">服务器内部错误</td>
</tr>
</tbody></table>
<h2 id="异常响应"><a href="#异常响应" class="headerlink" title="异常响应"></a>异常响应</h2><p>当 RESTful API 接口出现非 2xx 的 HTTP 错误码响应时，采用全局的异常结构响应信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 400 Bad Request</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: &quot;INVALID_ARGUMENT&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;&#123;error message&#125;&quot;,</span><br><span class="line">    &quot;cause&quot;: &quot;&#123;cause message&#125;&quot;,</span><br><span class="line">    &quot;request_id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">    &quot;host_id&quot;: &quot;&#123;server identity&#125;&quot;,</span><br><span class="line">    &quot;server_time&quot;: &quot;2014-01-01T12:00:00Z&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h2><p>在设计服务端的 RESTful API 的时候，我们还需要对请求参数进行限制说明。例如一个支持批量查询的接口，我们要考虑最大支持查询的数量。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】     &#x2F;v1&#x2F;users&#x2F;batch?user_ids&#x3D;1001,1002      &#x2F;&#x2F; 批量查询用户信息</span><br><span class="line">参数说明</span><br><span class="line">- user_ids: 用户ID串，最多允许 20 个。</span><br></pre></td></tr></table></figure>

<p>此外，在设计新增或修改接口时，我们还需要在文档中明确告诉调用者哪些参数是必填项，哪些是选填项，以及它们的边界值的限制。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【POST】     &#x2F;v1&#x2F;users                             &#x2F;&#x2F; 创建用户信息</span><br><span class="line">请求内容</span><br><span class="line">&#123;</span><br><span class="line">    &quot;username&quot;: &quot;lgz&quot;,                 &#x2F;&#x2F; 必填, 用户名称, max 10</span><br><span class="line">    &quot;realname&quot;: &quot;梁桂钊&quot;,               &#x2F;&#x2F; 必填, 用户名称, max 10</span><br><span class="line">    &quot;password&quot;: &quot;123456&quot;,              &#x2F;&#x2F; 必填, 用户密码, max 32</span><br><span class="line">    &quot;email&quot;: &quot;lianggzone@163.com&quot;,     &#x2F;&#x2F; 选填, 电子邮箱, max 32</span><br><span class="line">    &quot;weixin&quot;: &quot;LiangGzone&quot;,            &#x2F;&#x2F; 选填，微信账号, max 32</span><br><span class="line">    &quot;sex&quot;: 1                           &#x2F;&#x2F; 必填, 用户性别[1-男 2-女 99-未知]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="响应参数"><a href="#响应参数" class="headerlink" title="响应参数"></a>响应参数</h2><p>针对不同操作，服务端向用户返回的结果应该符合以下规范。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】     &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;      &#x2F;&#x2F; 返回单个资源对象</span><br><span class="line">【GET】     &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;                    &#x2F;&#x2F; 返回资源对象的列表</span><br><span class="line">【POST】    &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;                    &#x2F;&#x2F; 返回新生成的资源对象</span><br><span class="line">【PUT】     &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;      &#x2F;&#x2F; 返回完整的资源对象</span><br><span class="line">【PATCH】   &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;      &#x2F;&#x2F; 返回完整的资源对象</span><br><span class="line">【DELETE】  &#x2F;&#123;version&#125;&#x2F;&#123;resources&#125;&#x2F;&#123;resource_id&#125;      &#x2F;&#x2F; 状态码 200，返回完整的资源对象。</span><br><span class="line">                                                      &#x2F;&#x2F; 状态码 204，返回一个空文档</span><br></pre></td></tr></table></figure>

<p>如果是单条数据，则返回一个对象的 JSON 字符串。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">&#123;</span><br><span class="line">    &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">    &quot;name&quot; : &quot;example&quot;,</span><br><span class="line">    &quot;created_time&quot;: 1496676420000,</span><br><span class="line">    &quot;updated_time&quot;: 1496676420000,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果是列表数据，则返回一个封装的结构体。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">&#123;</span><br><span class="line">    &quot;count&quot;:100,</span><br><span class="line">    &quot;items&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">            &quot;name&quot; : &quot;example&quot;,</span><br><span class="line">            &quot;created_time&quot;: 1496676420000,</span><br><span class="line">            &quot;updated_time&quot;: 1496676420000,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一个完整的案例"><a href="#一个完整的案例" class="headerlink" title="一个完整的案例"></a>一个完整的案例</h2><p>最后，我们使用一个完整的案例将前面介绍的知识整合起来。这里，使用“获取用户列表”的案例。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">【GET】     &#x2F;v1&#x2F;users?[&amp;keyword&#x3D;xxx][&amp;enable&#x3D;1][&amp;offset&#x3D;0][&amp;limit&#x3D;20] 获取用户列表</span><br><span class="line">功能说明：获取用户列表</span><br><span class="line">请求方式：GET</span><br><span class="line">参数说明</span><br><span class="line">- keyword: 模糊查找的关键字。[选填]</span><br><span class="line">- enable: 启用状态[1-启用 2-禁用]。[选填]</span><br><span class="line">- offset: 获取位置偏移，从 0 开始。[选填]</span><br><span class="line">- limit: 每次获取返回的条数，缺省为 20 条，最大不超过 100。 [选填]</span><br><span class="line">响应内容</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">&#123;</span><br><span class="line">    &quot;count&quot;:100,</span><br><span class="line">    &quot;items&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;id&quot; : &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">            &quot;name&quot; : &quot;example&quot;,</span><br><span class="line">            &quot;created_time&quot;: 1496676420000,</span><br><span class="line">            &quot;updated_time&quot;: 1496676420000,</span><br><span class="line">            ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">失败响应</span><br><span class="line">HTTP&#x2F;1.1 403 UC&#x2F;AUTH_DENIED</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: &quot;INVALID_ARGUMENT&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;&#123;error message&#125;&quot;,</span><br><span class="line">    &quot;cause&quot;: &quot;&#123;cause message&#125;&quot;,</span><br><span class="line">    &quot;request_id&quot;: &quot;01234567-89ab-cdef-0123-456789abcdef&quot;,</span><br><span class="line">    &quot;host_id&quot;: &quot;&#123;server identity&#125;&quot;,</span><br><span class="line">    &quot;server_time&quot;: &quot;2014-01-01T12:00:00Z&quot;</span><br><span class="line">&#125;</span><br><span class="line">错误代码</span><br><span class="line">- 403 UC&#x2F;AUTH_DENIED    授权受限</span><br></pre></td></tr></table></figure>

<h1 id="参数接收"><a href="#参数接收" class="headerlink" title="参数接收"></a>参数接收</h1><p>本篇文章主要说下接口的数据参数到底该如何接收，我们知道一个http请求最重要的意义就是将数据在服务器上进行传入与传出，本章主要讲的也就是传入。一次请求传递参数的方式主要有 URL路径中、请求头中、请求体中还有通过cookie等，下面我们分别对几种方式进行讲解。</p>
<h2 id="MediaType的选择"><a href="#MediaType的选择" class="headerlink" title="MediaType的选择"></a>MediaType的选择</h2><p>MediaType即是Internet Media Type，互联网媒体类型；也叫做MIME类型，在Http协议消息头中，使用Content-Type来表示具体请求中的媒体类型信息。</p>
<p>对于POST、PUT、PATCH这种HTTP方法，统一使用 application/json，将参数放在请求体中以JSON格式传递至服务器<br>对于GET、DELETE的HTTP方法，使用默认类型（application/x-www-form-urlencoded）<br>★备注<br>特殊情况特殊考虑，例如进行文件上传时，使用 multipart/form-data类型等</p>
<h2 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h2><p>对应spring mvc框架中@PathVariable注解</p>
<p>接收参数方式为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public ResponseMessage get(@PathVariable(&quot;customerId&quot;)int customerId)&#123;</span><br><span class="line">	&#x2F;&#x2F;...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="请求头参数"><a href="#请求头参数" class="headerlink" title="请求头参数"></a>请求头参数</h2><p>对应spring mvc框架中@RequestHeader注解</p>
<p>对于提供给APP（android、ios、pc） 的接口我们可能需要关注一些调用信息，例如 用户登录信息、调用来源、app版本号、api的版本号、安全验证信息 等等，我们将这些信息放入头信息（HTTP HEAD中），下面给出在参数命名的例子：</p>
<p>Access-Token 用户的登录token（用于置换用户登录信息）<br>Api-Version api的版本号<br>App-Version app版本号<br>Call-Source 调用来源(IOS、ANDROID、PC、WECHAT、WEB)<br>Authorization 安全校验参数（后面会有文章详细介绍该如何做安全校验）<br>这时你可能会思考一下几个问题：</p>
<p>为什么需要收集 api版本号、app版本号、调用来源这些信息呢？<br>这里解释下，主要有几个原因：<br>①方便线上环境定位问题，这也是一个重要的原因（我们后面会讲通过切面全局打印非GET请求的接口调用日志）。<br>②我们可以通过这些参数信息处理我们的业务逻辑，而没有必要在用到的时候我们才想起来让调用者将信息传递过来，导致同一功能性的参数，参数名和参数值不统一的情况发生。<br>是每个接口都要这些参数么？<br>是的，建议将所有的接口都传递上述参数信息。<br>怎么做这些参数的校验呢？<br>你可以写个拦截器，统一校验你的接口中全局的header参数<br>★备注 </p>
<ul>
<li>Header参数大小写不敏感，所以参数Access-Token和ACCESS-TOKEN是一个参数</li>
</ul>
<h2 id="请求体参数"><a href="#请求体参数" class="headerlink" title="请求体参数"></a>请求体参数</h2><p>参数传递分为了大体两种 URL请求查询参数、请求体参数，对于请求体参数我们选择以JSON格式传递过来，URL请求查询参数、请求体参数这两种方式分别对应了spring mvc框架中的 @RequestParam、@RequestBody两个注解进行修饰。<br>我们下面以添加一个用户举例，用POSTMAN截图如下：</p>
<p><img src= "/img/loading.gif" data-src="http://upload-images.jianshu.io/upload_images/7477749-c6fdcdc835d413f7?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="创建用户"></p>
<h2 id="开发实例"><a href="#开发实例" class="headerlink" title="开发实例"></a>开发实例</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import javax.validation.Valid;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.http.HttpStatus;</span><br><span class="line">import org.springframework.web.bind.annotation.DeleteMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseStatus;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import com.zhuma.demo.comm.model.po.User;</span><br><span class="line">import com.zhuma.demo.user.service.user.UserService;</span><br><span class="line">import com.github.pagehelper.PageInfo;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 用户管理控制器</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;&#x2F;users&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line"></span><br><span class="line">    private final UserService userService;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public UserController(UserService userService) &#123;</span><br><span class="line">        this.userService &#x3D; userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping</span><br><span class="line">    public PageInfo&lt;User&gt; getUserList(@RequestParam(name&#x3D;&quot;pageNum&quot;, defaultValue&#x3D;&quot;1&quot;) Integer pageNum, </span><br><span class="line">                                      @RequestParam(name&#x3D;&quot;pageSize&quot;, defaultValue&#x3D;&quot;10&quot;) Integer pageSize,</span><br><span class="line">                                        @RequestParam(name&#x3D;&quot;queryUser&quot;) User queryUser) &#123;</span><br><span class="line">        return userService.pageList(queryUser, pageNum, pageSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;&#x2F;&#123;userId&#125;&quot;)</span><br><span class="line">    User getUser(@PathVariable(&quot;userId&quot;) Long userId) &#123;</span><br><span class="line">        return userService.getUserById(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PostMapping</span><br><span class="line">    @ResponseStatus(HttpStatus.CREATED)</span><br><span class="line">    public User addUser(@Valid @RequestBody User user) &#123;</span><br><span class="line">        return userService.register(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PutMapping</span><br><span class="line">    public User updateUser(@RequestBody User user) &#123;</span><br><span class="line">        return userService.updateDbAndCache(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @DeleteMapping(&quot;&#x2F;&#123;userId&#125;&quot;)</span><br><span class="line">    @ResponseStatus(HttpStatus.NO_CONTENT)</span><br><span class="line">    void deleteUser(@PathVariable(&quot;userId&quot;) Long userId) &#123;</span><br><span class="line">        userService.deleteUserById(userId);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>上面我们截取一个管理用户的功能控制器，其中可能有一些你不了解的注解，例如@Valid、@ResponseStatus，@Valid一般配合参数校验使用，@ResponseStatus直接修饰目标方法，不管是否触发异常，都会返回指定的异常和错误码，这里我们主要看@GetMapping、@PostMapping、 @PutMapping、@DeleteMapping 分别处理查询、修改、删除功能，@RequestParam、@RequestBody 分别表示 查询参数、json body请求体参数。</p>
<h1 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h1><h2 id="格式选择"><a href="#格式选择" class="headerlink" title="格式选择"></a>格式选择</h2><p>返回格式目前主流的应该只有XML、JSON两种吧，这里我们不做对比，我们使用JSON作为接口的返回格式。</p>
<h2 id="数据返回格式"><a href="#数据返回格式" class="headerlink" title="数据返回格式"></a>数据返回格式</h2><p>数据的返回格式其实是个比较纠结的问题，在restful风格中很多文章都讲解使用的是http状态码控制请求的结果状态，例如：http状态码为200~300的时候，为正常状态，response响应体即为所需要返回的数据，404时代表没有查询到数据，响应体即为空，500为系统错误，响应体也为空等等，但是这种方式也是存在很大问题的，一是http状态码是有限的，而且每个状态码都已经被赋予特殊的含义，在企业开发中当接口遇到错误的时候，我们可能更希望将结果状态码标记的更为详细，更利于前端开发者使用，毕竟写接口的目的也是方便前端使用，这样也可以降低前后端开发人员沟通成本。<br>下面给出我们在实际开发中使用的返回值统一格式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class ResponseMessage implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID &#x3D; 8992436576262574064L;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 是否成功</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private boolean success;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 反馈数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Object data;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 反馈信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String message;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 响应码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private int code;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 过滤字段：指定需要序列化的字段</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private transient Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; includes;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 过滤字段：指定不需要序列化的字段</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private transient Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; excludes;</span><br><span class="line"></span><br><span class="line">    private transient boolean onlyData;</span><br><span class="line"></span><br><span class="line">    private transient String callback;</span><br><span class="line"></span><br><span class="line">    public Map&lt;String, Object&gt; toMap() &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;success&quot;, this.success);</span><br><span class="line">        if (data !&#x3D; null)</span><br><span class="line">            map.put(&quot;data&quot;, this.getData());</span><br><span class="line">        if (message !&#x3D; null)</span><br><span class="line">            map.put(&quot;message&quot;, this.getMessage());</span><br><span class="line">        map.put(&quot;code&quot;, this.getCode());</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage() &#123;&#125;</span><br><span class="line">    protected ResponseMessage(String message) &#123;</span><br><span class="line">        this.code &#x3D; 500;</span><br><span class="line">        this.message &#x3D; message;</span><br><span class="line">        this.success &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage(boolean success, Object data) &#123;</span><br><span class="line">        this.code &#x3D; success ? 200 : 500;</span><br><span class="line">        this.data &#x3D; data;</span><br><span class="line">        this.success &#x3D; success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage(boolean success, Object data ,Object message) &#123;</span><br><span class="line">        this.code &#x3D; success ? 200 : 500;</span><br><span class="line">        this.data &#x3D; data;</span><br><span class="line">        this.success &#x3D; success;</span><br><span class="line">        this.message &#x3D; (String)message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected ResponseMessage(boolean success, Object data, int code) &#123;</span><br><span class="line">        this(success, data);</span><br><span class="line">        this.code &#x3D; code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(Class&lt;?&gt; type, String... fields) &#123;</span><br><span class="line">        return include(type, Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(Class&lt;?&gt; type, Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (includes &#x3D;&#x3D; null)</span><br><span class="line">            includes &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        if (fields &#x3D;&#x3D; null || fields.isEmpty()) return this;</span><br><span class="line">        fields.forEach(field -&gt; &#123;</span><br><span class="line">            if (field.contains(&quot;.&quot;)) &#123;</span><br><span class="line">                String tmp[] &#x3D; field.split(&quot;[.]&quot;, 2);</span><br><span class="line">                try &#123;</span><br><span class="line">                    Field field1 &#x3D; type.getDeclaredField(tmp[0]);</span><br><span class="line">                    if (field1 !&#x3D; null) &#123;</span><br><span class="line">                        include(field1.getType(), tmp[1]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Throwable e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                getStringListFormMap(includes, type).add(field);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(Class&lt;?&gt; type, Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (excludes &#x3D;&#x3D; null)</span><br><span class="line">            excludes &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        if (fields &#x3D;&#x3D; null || fields.isEmpty()) return this;</span><br><span class="line">        fields.forEach(field -&gt; &#123;</span><br><span class="line">            if (field.contains(&quot;.&quot;)) &#123;</span><br><span class="line">                String tmp[] &#x3D; field.split(&quot;[.]&quot;, 2);</span><br><span class="line">                try &#123;</span><br><span class="line">                    Field field1 &#x3D; type.getDeclaredField(tmp[0]);</span><br><span class="line">                    if (field1 !&#x3D; null) &#123;</span><br><span class="line">                        exclude(field1.getType(), tmp[1]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Throwable e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                getStringListFormMap(excludes, type).add(field);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (excludes &#x3D;&#x3D; null)</span><br><span class="line">            excludes &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        if (fields &#x3D;&#x3D; null || fields.isEmpty()) return this;</span><br><span class="line">        Class&lt;?&gt; type;</span><br><span class="line">        if (data !&#x3D; null) type &#x3D; data.getClass();</span><br><span class="line">        else return this;</span><br><span class="line">        exclude(type, fields);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(Collection&lt;String&gt; fields) &#123;</span><br><span class="line">        if (includes &#x3D;&#x3D; null)</span><br><span class="line">            includes &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        if (fields &#x3D;&#x3D; null || fields.isEmpty()) return this;</span><br><span class="line">        Class&lt;?&gt; type;</span><br><span class="line">        if (data !&#x3D; null) type &#x3D; data.getClass();</span><br><span class="line">        else return this;</span><br><span class="line">        include(type, fields);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(Class&lt;?&gt; type, String... fields) &#123;</span><br><span class="line">        return exclude(type, Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ResponseMessage exclude(String... fields) &#123;</span><br><span class="line">        return exclude(Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage include(String... fields) &#123;</span><br><span class="line">        return include(Arrays.asList(fields));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected Set&lt;String&gt; getStringListFormMap(Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; map, Class&lt;?&gt; type) &#123;</span><br><span class="line">        Set&lt;String&gt; list &#x3D; map.get(type);</span><br><span class="line">        if (list &#x3D;&#x3D; null) &#123;</span><br><span class="line">            list &#x3D; new HashSet&lt;&gt;();</span><br><span class="line">            map.put(type, list);</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isSuccess() &#123;</span><br><span class="line">        return success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSuccess(boolean success) &#123;</span><br><span class="line">        this.success &#x3D; success;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Object getData() &#123;</span><br><span class="line">        return data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage setData(Object data) &#123;</span><br><span class="line">        this.data &#x3D; data;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return JSON.toJSONStringWithDateFormat(this, DateTimeUtils.YEAR_MONTH_DAY_HOUR_MINUTE_SECOND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage setCode(int code) &#123;</span><br><span class="line">        this.code &#x3D; code;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage fromJson(String json) &#123;</span><br><span class="line">        return JSON.parseObject(json, ResponseMessage.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; getExcludes() &#123;</span><br><span class="line">        return excludes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Map&lt;Class&lt;?&gt;, Set&lt;String&gt;&gt; getIncludes() &#123;</span><br><span class="line">        return includes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage onlyData() &#123;</span><br><span class="line">        setOnlyData(true);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOnlyData(boolean onlyData) &#123;</span><br><span class="line">        this.onlyData &#x3D; onlyData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isOnlyData() &#123;</span><br><span class="line">        return onlyData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ResponseMessage callback(String callback) &#123;</span><br><span class="line">        this.callback &#x3D; callback;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getCallback() &#123;</span><br><span class="line">        return callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getMessage() &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMessage(String message) &#123;</span><br><span class="line">        this.message &#x3D; message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage ok() &#123;</span><br><span class="line">        return ok(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage created(Object data) &#123;</span><br><span class="line">        return new ResponseMessage(true, data, 201);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage ok(Object data) &#123;</span><br><span class="line">        return new ResponseMessage(true, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage error(String message) &#123;</span><br><span class="line">        return new ResponseMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ResponseMessage error(String message, int code) &#123;</span><br><span class="line">        return new ResponseMessage(message).setCode(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">混饭</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hunfan.top/posts/d1792dcc/">http://hunfan.top/posts/d1792dcc/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hunfan.top" target="_blank">混饭's Notes</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/RESTful/">RESTful</a></div><div class="post_share"><div class="social-share" data-image="/upload/homePage/20200628154000.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/c4cf9967/"><img class="prev-cover" data-src="/upload/homePage/20180906170335.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux查询占用文件的进程</div></div></a></div><div class="next-post pull-right"><a href="/posts/9c6dc1e8/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mysql FEDREATED存储引擎</div></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'FbdjjSByqhjHC2t0f5DiTzXi-gzGzoHsz',
  appKey: 'EhyT8E3CKzF9CQcem5hx7ftx',
  placeholder: '记得留下你的昵称和邮箱...可以快速收到回复',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'en',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2017 - 2020 By 混饭</div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>鲁ICP备19006622号-1 版权所有</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/algolia.js"></script></body></html>